"use strict";

/**
 * Express MVC
 * @author Mike Adamczyk <mike@bom.us>
 */

//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
//@::::::::::'@@+'''''''@@@@:::::::::'#@@@@@@@@@@@:::::::::::::::@
//@:::::::::@@#'''''''''++'@@#::;+@@@@@@@@@#####@@@::::::::::::::@
//@:::::::'@@''''''''''''''''@@@@@@#''@@@########@@#:::::::::::::@
//@::::::#@#+'''''''''''''''@@@''''''@@############@:::::::::::::@
//@:::::#@++#''''''''''''+@@#'''''''@@#############@#::::::::::::@
//@::::;@#++@''''''''''#@@+'''''''#@@@@@@@@######@@+:::::::::::::@
//@::::@@+++#''''''''#@@''''''''+@@#@@@@@@@@@@##@@:::::::::::::::@
//@:::#@+++++@'''''@@@@#'''''#@@#:::::::::'@@@@@+::::::::::::::::@
//@:::@@+++++#+''#@@@@+#@@@@@+::::::::::::::::@@@::::::::::::::::@
//@:::@+++++++@#@@@@;:::::::::::::::::::::::::::+@@::::::::::::::@
//@::;@+++++++@@@@;:::::::::::::::::::::::::::::::+@+::::::::::::@
//@::'@++++++@@@+:::::::@@@@@@@@@@@@@@@@#:::::::::::@@:::::::::::@
//@::;@+++++@@@:::::::#@@`@@@@@@@@@@@@@@@@@+::::::::;;@#:::::::::@
//@:::@++++#@@:::::'@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+::@
//@:::@#+++@@::,'@@@@@@+@@,...````````.'@@@@@@@@@@@@@@@@@@@@@#@::@
//@:::@@++@@:'@@@@@@+:::@@;````:+,`````+@@@@@@@@@@@@@@#@@@@@@@@::@
//@::::@++@'+@@@@+::::::@@#```'@@@````.@@@@@@@@@@@@@@,``..`@+@@::@
//@::::@@@@:@@#,::::::::@@@.`.@.+@.````@@@@,;+##;,:@@.``````@@#::@
//@::::@@@+:@@::::::::::@@@```+ :@`````@@@'@@@@@@@+@@..'```.@@'::@
//@::::@@@,:@@::::::::::;@@;```@@.````;@@;@@;::::#@@@:@@@```@@@::@
//@:::#@@@::@#:::::::::::@@@```..````.@@@,@@:::::::@@'@ #;``@@,@:@
//@:::@@@'::@#:::::::::::#@@#.```````,@@@:@@+::::::;@@' #:`:@@:;@@
//@:::@@@,::@@::::::::::::@@@#```````@@@::@@@@::::::@@`:+`.@@+::@@
//@::@@@@:::#@::::::::::::'@@@@#,``,@@@@:::@;#@@::::@@@```'@@::::@
//@:@@@@@@::;@:::::::::::::#@@@@@@@@@@#::::;@;;@#::@'@@@@@@@:::::@
//@#@@@#@@@:::::::::::::::::;@@@@@@@@::::::::@@;@:@#:;@@@@+::::::@
//@@@@@::@@@::::::::::::::::::::;::::::::::::::#@##::::,,::::::::@
//@@@@::::@@#:::::::::::::::::::::::::::::::::::+':::::::::::::::@
//@@@::::::@@':::::::::::::::::::::::::::::::::::::::::::::::::::@
//@@+::::::;@@:::::::::::::::::::::::::::::::::::::::::::::::::::@
//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@


var Application = require('./src/application');

var Provider = require('./src/provider');

var applicationProviders = {};
[
    'logger',
    'url',
    'cli',
    'seeder',
    'database',
    'auth',
    'controller',
    'controllerDefaults',
    'model',
    'template',
    'view',
    'locale',
    'express',
    'router',
    'gate'

].map(function(name) {
    require('./src/providers/' + name);
});

/**
 * The Express MVC application.
 * @type {{}}
 */
module.exports = {

    /**
     * The Application class.
     * @type Application
     */
    Application: Application,

    /**
     * The Provider class.
     * @type Provider
     */
    Provider: Provider,

    /**
     * Initialize the application and bootstrap.
     * @param rootPath string
     * @param env string, optional
     * @returns {Application}
     */
    init: function(rootPath,env)
    {
        Application.setRootPath(rootPath);

        var config = require(Application.rootPath('config/config')) (Provider.get());

        return new Application(config,env);
    }
};